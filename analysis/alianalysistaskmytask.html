
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Your analysis task Â· ALICE Analysis Tutorial</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-katex/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-panels/panels.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-block-align/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-toc/page-toc.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../css/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="local.html" />
    
    
    <link rel="prev" href="classes.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../start/">
            
                <a href="../start/">
            
                    
                    Getting started
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../start/cert.html">
            
                <a href="../start/cert.html">
            
                    
                    Get a Grid certificate
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../building/">
            
                <a href="../building/">
            
                    
                    Build ALICE software
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../building/custom.html">
            
                <a href="../building/custom.html">
            
                    
                    ðŸ§ª Installation via alibuild
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../building/prereq-centos7.html">
            
                <a href="../building/prereq-centos7.html">
            
                    
                    Prerequisites for CentOS 7
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../building/prereq-centos8.html">
            
                <a href="../building/prereq-centos8.html">
            
                    
                    Prerequisites for CentOS 8
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="../building/prereq-macos.html">
            
                <a href="../building/prereq-macos.html">
            
                    
                    Prerequisites for macOS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="../building/prereq-ubuntu.html">
            
                <a href="../building/prereq-ubuntu.html">
            
                    
                    Prerequisites for Ubuntu
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.5" data-path="../building/prereq-fedora.html">
            
                <a href="../building/prereq-fedora.html">
            
                    
                    Prerequisites for Fedora
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../building/build.html">
            
                <a href="../building/build.html">
            
                    
                    ðŸ›  Build the packages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../building/precomp.html">
            
                <a href="../building/precomp.html">
            
                    
                    ðŸ“¦ Use the precompiled binaries
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../building/devel.html">
            
                <a href="../building/devel.html">
            
                    
                    ðŸ’ª Develop a single package (Experimental)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="welcome.html">
            
                <a href="welcome.html">
            
                    
                    Writing an analysis task
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="classes.html">
            
                <a href="classes.html">
            
                    
                    AliAnalysisTaskSE
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4.2" data-path="alianalysistaskmytask.html">
            
                <a href="alianalysistaskmytask.html">
            
                    
                    Your analysis task
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="local.html">
            
                <a href="local.html">
            
                    
                    Running locally
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="rungrid.html">
            
                <a href="rungrid.html">
            
                    
                    Running on Grid
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="lego.html">
            
                <a href="lego.html">
            
                    
                    The LEGO train system
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="monalisa.html">
            
                <a href="monalisa.html">
            
                    
                    AliMonitor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="oadb.html">
            
                <a href="oadb.html">
            
                    
                    Offline analysis database
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="trouble.html">
            
                <a href="trouble.html">
            
                    
                    Troubleshooting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="streamer.html">
            
                <a href="streamer.html">
            
                    
                    The ROOT streamer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="destructor.html">
            
                <a href="destructor.html">
            
                    
                    Destructors
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="./">
            
                <a href="./">
            
                    
                    Analysis tutorial exercises
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="setup.html">
            
                <a href="setup.html">
            
                    
                    Step 1 - Setup the tutorial
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="running.html">
            
                <a href="running.html">
            
                    
                    Step 2 - Running the task
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="modify.html">
            
                <a href="modify.html">
            
                    
                    Step 3 - Modify the task
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="track.html">
            
                <a href="track.html">
            
                    
                    Step 4 -The track loop
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="pid.html">
            
                <a href="pid.html">
            
                    
                    Step 5 -Particle identification
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="MC.html">
            
                <a href="MC.html">
            
                    
                    Step 6 -Using Monte Carlo data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="grid.html">
            
                <a href="grid.html">
            
                    
                    Step 7 -Run your code on GRID
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="bonus.html">
            
                <a href="bonus.html">
            
                    
                    Bonus content
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="hints.html">
            
                <a href="hints.html">
            
                    
                    Some hints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="ROOT5-to-6.html">
            
                <a href="ROOT5-to-6.html">
            
                    
                    Transition from ROOT5 to ROOT6
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../rivet/rivet-tutorial.html">
            
                <a href="../rivet/rivet-tutorial.html">
            
                    
                    Rivet
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../rivet/getting-started.html">
            
                <a href="../rivet/getting-started.html">
            
                    
                    Getting started with Rivet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../rivet/rivet-in-alice.html">
            
                <a href="../rivet/rivet-in-alice.html">
            
                    
                    Using Rivet in ALICE
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../rivet/implementing-rivet-analysis.html">
            
                <a href="../rivet/implementing-rivet-analysis.html">
            
                    
                    Implementing a Rivet analysis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../rivet/hi-features.html">
            
                <a href="../rivet/hi-features.html">
            
                    
                    Introduction to heavy-ion features
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../rivet/reference-manual.html">
            
                <a href="../rivet/reference-manual.html">
            
                    
                    Reference manual for Rivet in ALICE
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../rivet/publishing-procedures.html">
            
                <a href="../rivet/publishing-procedures.html">
            
                    
                    Procedures for publishing Rivet analyses
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../rivet/advanced-topics.html">
            
                <a href="../rivet/advanced-topics.html">
            
                    
                    Advanced topics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../rivet/advanced-hi-features.html">
            
                <a href="../rivet/advanced-hi-features.html">
            
                    
                    Advanced heavy-ion features
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../rivet/coding-conventions.html">
            
                <a href="../rivet/coding-conventions.html">
            
                    
                    Coding conventions for Rivet plugins
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="../rivet/references.html">
            
                <a href="../rivet/references.html">
            
                    
                    References
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Your analysis task</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="your-analysis-task">Your analysis task</h1>
<p>In the previous section we discussed some of the basics of writing an analysis task from a &apos;theoretical viewpoint&apos;. In this section, we will go through a working analysis class line-by-line. </p>
<p>As you now know, your own analysis task will be derived from the base class <code>AliAnalysisTaskSE</code>. We will use a <em>fixed format</em> to write our tasks, which means that we need to create three files:</p>
<ul>
<li><p>The <strong>header</strong> file (.h) which contains function <em>prototypes</em> and in which your class members are defined</p>
</li>
<li><p>The <strong>implementation</strong> file (.cxx), in which the methods of your analysis are implemented</p>
</li>
<li><p>An <strong>AddTask.C</strong> macro which creates an <strong>instance</strong> of your class
and <strong>configures</strong> it.</p>
</li>
</ul>
<h2 id="the-class-header-h">The class header (.h)</h2>
<p>Let&#x2019;s start by looking at our header (the .h file), where we define the prototypes of all the methods that we want to implement in our class</p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> AliAnalysisTaskMyTask_H</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> AliAnalysisTaskMyTask_H</span>

<span class="hljs-keyword">class</span> AliAnalysisTaskMyTask : <span class="hljs-keyword">public</span> AliAnalysisTaskSE  
{
<span class="hljs-keyword">public</span>:
   <span class="hljs-comment">// two class constructors</span>
   AliAnalysisTaskMyTask();
   AliAnalysisTaskMyTask(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name);
   <span class="hljs-comment">// class destructor</span>
   <span class="hljs-keyword">virtual</span>                 ~AliAnalysisTaskMyTask();
   <span class="hljs-comment">// called once at beginning of runtime</span>
   <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span>            <span class="hljs-title">UserCreateOutputObjects</span><span class="hljs-params">()</span></span>;
   <span class="hljs-comment">// called for each event</span>
   <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span>            <span class="hljs-title">UserExec</span><span class="hljs-params">(Option_t\* option)</span></span>;
   <span class="hljs-comment">// called at end of analysis</span>
   <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span>            <span class="hljs-title">Terminate</span><span class="hljs-params">(Option_t\* option)</span></span>;
  <span class="hljs-comment">/// \cond CLASSDEF</span>
  ClassDef(AliAnalysisTaskMyTask, <span class="hljs-number">1</span>);
  <span class="hljs-comment">/// \endcond</span>
};

<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
</code></pre>
<p>Let&apos;s go through the snippet of code line-by-line. First of all, we see</p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> AliAnalysisTaskMyTask_H</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> AliAnalysisTaskMyTask_H</span>
.
.
.
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
</code></pre>
<p>These three lines form an <strong>include guard</strong> (sometimes called macro guard, or header guard). This construct is used to avoid the problem of <strong>double inclusion</strong>: should the header of your class be included more than once, the include guard will protect your code from double definitions which result in invalid code. </p>
<p><div class="panel panel-success"><div class="panel-heading"><h3 class="panel-title" onclick="javascript:toggle(5604089151);" id="-include-guards"><i class="fa fa-square-o"></i>  Include guards<span id="heading-5604089151"></span></h3></div><div class="panel-body" id="panel-5604089151"><p>What is the risk of <em>not</em> using include guards?</p>
<div class="panel panel-danger"><div class="panel-heading"><h3 class="panel-title" onclick="javascript:toggle(1593187482);" id="-drum-roll-click-to-expand"><i class="fa fa-line-chart"></i>  drum roll <span id="heading-1593187482">Click to expand</span></h3></div><div class="panel-body" style="display: none" id="panel-1593187482"><p>Say that you have a header file, called <code>grandparent.h</code>, in which you define a struct</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">struct</span> foo {
    <span class="hljs-keyword">int</span> member;
};
</code></pre>
<p>and you create a second file <code>parent.h</code> where you write</p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-string">&quot;grandparent.h&quot;</span></span>
</code></pre>
<p>and even a third one, <code>child.h</code> in which you do</p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-string">&quot;grandparent.h&quot;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-string">&quot;parent.h&quot;</span></span>
</code></pre>
<p>After preprocessing, the content of the file <code>child.h</code> will be</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">struct</span> foo {
    <span class="hljs-keyword">int</span> member;
};
<span class="hljs-keyword">struct</span> foo {
    <span class="hljs-keyword">int</span> member;
};
</code></pre>
<p>since <code>child.h</code> has indirectly included two copies of the text in the header file <code>grandparent.h</code>. This will cause a compilation error, since the struct <code>foo</code> will be defined twice. Using include guards, this problem would not have arisen. </p>
</div></div></div></div></p>
<h2 id="class-definition-and-constructors">Class definition and constructors</h2>
<p>If we continue looking at the code, we see the class definition and two class constructors</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">class</span> AliAnalysisTaskMyTask : <span class="hljs-keyword">public</span> AliAnalysisTaskSE  
{
<span class="hljs-keyword">public</span>:
   <span class="hljs-comment">// two class constructors</span>
   AliAnalysisTaskMyTask();
   AliAnalysisTaskMyTask(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name);
   <span class="hljs-comment">// class destructor</span>
   <span class="hljs-keyword">virtual</span>                 ~AliAnalysisTaskMyTask();
</code></pre>
<p>The first line means that we define a class <code>AliAnalysisTaskMyTask</code>, which is derived from <code>AliAnalysisTaskSE</code>. </p>
<h3 id="class-constructors-and-destructor">Class constructors and destructor</h3>
<p>The two functions <code>AliAnalysisTaskMyTask()</code> and <code>AliAnalysisTaskMyTask(const char *name)</code> are <strong>class constructors</strong>. A class constructor is a special function in a class that is called when a new object of the class is created. </p>
<p>We always need to define <em>two</em> class constructors for our analysis task, why this is, will be explained later. The third function is the class <em>destructor</em>. A destructor is also a special function which is called when the created object is deleted. We will later see, that a class that has pointer data members should include, in addition to a destructor, a copy constructor and an assignment operator - but for now we can just forget about those. </p>
<h2 id="alianalysistaskse-inherited-functions">AliAnalysisTaskSE inherited functions</h2>
<p>After the constructors and destructors, we define the prototypes of the functions that we have already seen in the <code>AliAnalysisTaskSE</code> section</p>
<pre><code class="lang-cpp">   <span class="hljs-comment">// called once at beginning of runtime</span>
   <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span>            <span class="hljs-title">UserCreateOutputObjects</span><span class="hljs-params">()</span></span>;
   <span class="hljs-comment">// called for each event</span>
   <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span>            <span class="hljs-title">UserExec</span><span class="hljs-params">(Option_t* option)</span></span>;
   <span class="hljs-comment">// called at end of analysis</span>
   <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span>            <span class="hljs-title">Terminate</span><span class="hljs-params">(Option_t* option)</span></span>;
</code></pre>
<p>These functions will be the heart of our analysis. In the <code>UserCreateOutputObjects</code>, we will define whatever output we want to write to our <code>root</code> files. The <code>UserExec</code> function will be called for all events in the data sample that we are looking at. Finally, <code>Terminate</code> is called at the very end of the analysis. </p>
<p><div class="panel panel-success"><div class="panel-heading"><h3 class="panel-title" onclick="javascript:toggle(1918496594);" id="-virtual-functions-"><i class="fa fa-square-o"></i>  Virtual functions <span id="heading-1918496594"></span></h3></div><div class="panel-body" id="panel-1918496594"><p>In the code snippet above, we see the <code>virtual</code> keyword. Do you know what this means ? </p>
<div class="panel panel-danger"><div class="panel-heading"><h3 class="panel-title" onclick="javascript:toggle(2087117641);" id="-click-to-show-answer-click-to-expand"><i class="fa fa-line-chart"></i>  Click to show answer <span id="heading-2087117641">Click to expand</span></h3></div><div class="panel-body" style="display: none" id="panel-2087117641"><p>Consider the following simple program which is an example of runtime polymorphism.
The main thing to note about the program is, derived class function is called using a base class pointer. The idea is, virtual functions are called according to the type of object pointed or referred, not according to the type of pointer or reference. In other words, virtual functions are resolved late, at runtime (which makes them powerful, but costly):</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">class</span> Employee 
{ 
<span class="hljs-keyword">public</span>: 
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">raiseSalary</span><span class="hljs-params">()</span> 
    </span>{  <span class="hljs-comment">/* common raise salary code */</span>  } 

    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">promote</span><span class="hljs-params">()</span> 
    </span>{ <span class="hljs-comment">/* common promote code */</span> } 
}; 

<span class="hljs-keyword">class</span> Manager: <span class="hljs-keyword">public</span> Employee { 
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">raiseSalary</span><span class="hljs-params">()</span> 
    </span>{  <span class="hljs-comment">/* Manager specific raise salary code, may contain 
          increment of manager specific incentives*/</span>  } 

    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">promote</span><span class="hljs-params">()</span> 
    </span>{ <span class="hljs-comment">/* Manager specific promote */</span> } 
}; 

<span class="hljs-comment">// Similarly, there may be other types of employees </span>

<span class="hljs-comment">// We need a very simple function to increment salary of all employees </span>
<span class="hljs-comment">// Note that emp[] is an array of pointers and actual pointed objects can </span>
<span class="hljs-comment">// be any type of employees. This function should ideally be in a class  </span>
<span class="hljs-comment">// like Organization, we have made it global to keep things simple </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">globalRaiseSalary</span><span class="hljs-params">(Employee *emp[], <span class="hljs-keyword">int</span> n)</span> 
</span>{ 
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) 
        emp[i]-&gt;raiseSalary(); <span class="hljs-comment">// Polymorphic Call: Calls raiseSalary()  </span>
                               <span class="hljs-comment">// according to the actual object, not  </span>
                               <span class="hljs-comment">// according to the type of pointer                                  </span>
} 
</code></pre>
<p>Outputs  <strong>???</strong></p>
<pre><code class="lang-cpp">In Derived
</code></pre>
<p>So, virtual functions allow us to create a list of base class pointers and call methods of any of the derived classes without even knowing the type of the derived class object. </p>
</div></div></div></div></p>
<h2 id="histograms-lists-and-more">Histograms, lists, and more</h2>
<p>Now that we have defined the methods of our analysis class, it is time to add some members. What we are going to add, are three pointer data members</p>
<ul>
<li><code>fAOD</code> which is a pointer to an event</li>
<li><code>fOutputList</code> which is a (pointer to a) list that holds all our output objects</li>
<li><code>fHistPt</code> which is a (pointer to a) histogram that will hold our pt spectrum</li>
</ul>
<p>Since these members are part of our class definition, we have to add them to our header file</p>
<pre><code class="lang-cpp">    <span class="hljs-keyword">class</span> AliAnalysisTaskMyTask : <span class="hljs-keyword">public</span> AliAnalysisTaskSE
    .
    .
    .
     <span class="hljs-keyword">private</span>:
       AliAODEvent*  fAOD;           <span class="hljs-comment">//!&lt;! input event</span>
       TList*        fOutputList;    <span class="hljs-comment">//!&lt;! output list</span>
       TH1F*         fHistPt;        <span class="hljs-comment">//!&lt;! dummy histogram</span>
</code></pre>
<p>In the code snippet above, you might see something interesting: when we write comments that describe what our class members are doing, we append the expression <code>!&lt;!</code> to the double slashes <code>//</code> that start our comment giving us <code>//!&lt;!</code>. Contrary to what you might think, this expression mark is seen by ROOT (even though it&apos;s written as a comment) and it is essential for the correct documentation generation. We will get later to the logic of this locution, but for now a rule of thumb suffices: pointers to objects that are initialized at <strong>run-time</strong> (in the <code>User*</code> methods) should be marked with a <code>//!&lt;!</code>.</p>
<h2 id="the-classdef-definition">The ClassDef definition</h2>
<p>At the very end of our header file, we add the following line</p>
<pre><code class="lang-cpp"><span class="hljs-comment">/// \cond CLASSDEF</span>
ClassDef(AliAnalysisTaskMyTask, <span class="hljs-number">1</span>);
<span class="hljs-comment">/// \endcond</span>
};
</code></pre>
<p>There is a lot going on behind this one single line: <code>ClassDef</code> is a C preprocessor macro that must be used if your class derives from <code>TObject</code>. <code>ClassDef</code> contains member declarations, i.e. it inserts a few new members into your class; the <code>ClassDef</code> macro family is defined in the file <code>Rtypes.h</code>, should you be interested.
The two comments surrounding the <code>ClassDef</code> statement are required to properly produce the documentation.</p>
<p>How all this works exactly is not very relevant at this point. We will later see that you will need to increase the version number whenever you change the definition of your class, or ROOT will not be able to handle objects written before and after this change in one process. The version number 0 (zero) disables I/O for the class completely, so we start counting at 1. </p>
<h1 id="the-implementation-of-your-analysis-task-cxx">The implementation of your analysis task (.cxx)</h1>
<p>We are for now done with our class header, it&apos;s time to move to the implementation of the class: the <code>AliAnalysisTaskMyTask.cxx</code> file, in which we will actually <em>implement</em> our methods. Let&apos;s start by defining our class constructors. As stated before, ROOT requires <strong>two</strong> class constructors (we&#x2019;ll get later to why this is necessary), one of which is the I/O constructor, which is not allowed to allocate any memory. So we start our implementation with</p>
<pre><code class="lang-cpp">        AliAnalysisTaskMyTask::AliAnalysisTaskMyTask() : AliAnalysisTaskSE(), 
            fAOD{<span class="hljs-number">0</span>}, fOutputList{<span class="hljs-number">0</span>}, fHistPt{<span class="hljs-number">0</span>}
        {
            <span class="hljs-comment">// ROOT IO constructor, don&apos;t allocate memory here!</span>
        }
        AliAnalysisTaskMyTask::AliAnalysisTaskMyTask(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* name) : AliAnalysisTaskSE(name),
            fAOD{<span class="hljs-number">0</span>}, fOutputList{<span class="hljs-number">0</span>}, fHistPt{<span class="hljs-number">0</span>}
        {
            DefineInput(<span class="hljs-number">0</span>, TChain::Class()); 
            DefineOutput(<span class="hljs-number">1</span>, TList::Class()); 
        }
</code></pre>
<p>As you see, in the constructor, we <strong>initialize</strong> members to their <strong>default</strong> values. <strong>Always</strong> initialize members to default values (and pointers to <code>nullptr</code>). If you fail to do so, values contained by the members will be random, which can lead to unexpected behavior of your code. </p>
<p><div class="panel panel-success"><div class="panel-heading"><h3 class="panel-title" onclick="javascript:toggle(6179534915);" id="-undefined-behavior-"><i class="fa fa-square-o"></i>  Undefined behavior <span id="heading-6179534915"></span></h3></div><div class="panel-body" id="panel-6179534915"><p>You have written a small function</p>
<pre><code class="lang-cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">f</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span>
</span>{
    <span class="hljs-keyword">int</span> a;
    <span class="hljs-keyword">if</span>(x&gt;<span class="hljs-number">0</span>) a = <span class="hljs-number">42</span>;
    <span class="hljs-keyword">return</span> a; 
}
</code></pre>
<p>What happens when you call</p>
<pre><code class="lang-cpp">f(<span class="hljs-number">10</span>)
</code></pre>
<p>and what happens when you call</p>
<pre><code class="lang-cpp">f(<span class="hljs-number">-10</span>)
</code></pre>
<p>?</p>
<div class="panel panel-danger"><div class="panel-heading"><h3 class="panel-title" onclick="javascript:toggle(808160006);" id="-drum-rollclick-to-expand"><i class="fa fa-line-chart"></i>  drum roll<span id="heading-808160006">Click to expand</span></h3></div><div class="panel-body" style="display: none" id="panel-808160006"><p>f(10) will return 42. The output of f(-10) is <em>undefined</em>, since variable a was not initialized. </p>
</div></div></div></div></p>
<p>In the second constructor of this task, we define what the <em>input</em> and <em>output</em> does the analysis class handle. In our case, the input is of type <code>TChain</code>, and as we will see later, the output is a <code>TList</code>. </p>
<h2 id="usercreateoutputobjects">UserCreateOutputObjects()</h2>
<p>In our <code>UserCreateOutputObjects</code> function, we will define the output objects of our task. These are commonly histograms, profiles, etc. In our specific example, we will add one histogram, and define a list to which we will attach the histogram. 
<div class="panel panel-primary"><div class="panel-heading"><h3 class="panel-title" onclick="javascript:toggle(6294387782);" id="output-lists"><i class="fa fa-info-circle"></i> Output lists<span id="heading-6294387782"></span></h3></div><div class="panel-body" id="panel-6294387782"><p>Adding all your output histograms to a list makes your life easier: the list will allow you to manipulate many output objects simultaneously. By calling <code>TList::SetOwner(true)</code>, we transfer ownership of all memory allocated by the list items to the <code>TList</code> itself, this means that in our destructor, we can simply call <code>delete list</code> to delete all our list items, rather than calling <code>delete</code> for all items individually. </p>
</div></div></p>
<p>The implementation of the <code>UserCreateOutputObjects</code> method looks like this </p>
<pre><code class="lang-cpp">    ...
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-string">&quot;TList.h&quot;</span></span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-string">&quot;TH1F.h&quot;</span></span>
    ...
    AliAnalysisTaskMyTask::UserCreateOutputObjects()
    {
        <span class="hljs-comment">// create a new TList that OWNS its objects</span>
        fOutputList = <span class="hljs-keyword">new</span> TList();
        fOutputList-&gt;SetOwner(<span class="hljs-literal">true</span>);

        <span class="hljs-comment">// create our histo and add it to the list</span>
        fHistPt = <span class="hljs-keyword">new</span> TH1F(<span class="hljs-string">&quot;fHistPt&quot;</span>, <span class="hljs-string">&quot;fHistPt&quot;</span>, <span class="hljs-number">100</span>, <span class="hljs-number">0</span>, <span class="hljs-number">100</span>);
        fOutputList-&gt;Add(fHistPt);

        <span class="hljs-comment">// add the list to our output file</span>
        PostData(<span class="hljs-number">1</span>,fOutputList); 
    }
</code></pre>
<p>Note that we create a <code>TList</code> and make it the owner of the memory of all its elements. After we create the histogram, we add it to the output list. Finally, in the last line, we call <code>PostData</code>, which will notify the client tasks of the data container that that the data pointer has changed compared to the previous post. </p>
<h2 id="userexec">UserExec</h2>
<p>The <code>UserExec</code> is the heart of our analysis: it is called for each event in our input data set. First, we need to access our event, which we can do via a call to the method <code>InputEvent</code> </p>
<pre><code class="lang-cpp">    ...
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-string">&quot;AliAODEvent.h&quot;</span></span>
    ...
    AliAnalysisTaskMyTask::UserExec(Option_t*)
    {
      <span class="hljs-comment">// get an event from the analysis manager</span>
      fAOD = <span class="hljs-keyword">dynamic_cast</span>&lt;AliAODEvent*&gt;(InputEvent());

      <span class="hljs-comment">// check if there actually is an event</span>
      <span class="hljs-keyword">if</span>(!fAOD)
        ::Fatal(<span class="hljs-string">&quot;AliAnalysisTaskMyTask::UserExec&quot;</span>, <span class="hljs-string">&quot;No AOD event found, check the event handler.&quot;</span>);
</code></pre>
<p>Once we have access to our input event, we can e.g. loop over all the tracks that it contains, and store the pt of the tracks in our histogram:</p>
<pre><code class="lang-cpp">        ...
        <span class="hljs-comment">// let&apos;s loop over the tracks and fill our histogram</span>

        <span class="hljs-comment">// first we get the number of tracks</span>
        <span class="hljs-keyword">int</span> iTracks{fAOD-&gt;GetNumberOfTracks()};

        <span class="hljs-comment">// and then loop over them</span>
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i{<span class="hljs-number">0</span>}; i &lt; iTracks; i++) {
            AliAODTrack* track = <span class="hljs-keyword">static_cast</span>&lt;AliAODTrack*&gt;(fAOD-&gt;GetTrack(i));
            <span class="hljs-keyword">if</span>(!track) <span class="hljs-keyword">continue</span>;

            <span class="hljs-comment">// here we do some track selection</span>
            <span class="hljs-keyword">if</span>(!track-&gt;TestFilterbit(<span class="hljs-number">128</span>) <span class="hljs-keyword">continue</span>;

            <span class="hljs-comment">// fill our histogram</span>
            fHistPt-&gt;Fill(track-&gt;Pt());
        }
        <span class="hljs-comment">// and save the data gathered in this iteration</span>
        PostData(<span class="hljs-number">1</span>, fOutputList);
    }
</code></pre>
<p>Take a look at the code and make sure that you understand the logic of all the lines. In principle, this is all you need in an analysis task to run a small analysis. </p>
<h2 id="almost-there-the-addtask-macro">Almost there: the AddTask macro</h2>
<p>The last thing that we need to fully define our analysis task, is a small file, that we will call the <code>AddTask</code> macro, that <em>instantiates</em> our task (class), defines its in- and output, and connects it to the <em>analysis manager</em>. We will put this piece of code in an independent, third file, called <code>AddMyTask.C</code>. It is important, that this macro defines a function, in our case called <code>AddMyTask</code>, that returns a pointer to our analysis task. We need to follow this exact convention if we later on want to run our analysis in the automated LEGO train system. </p>
<p>Our <code>AddTask</code> macro looks as follows:</p>
<pre><code class="lang-cpp"><span class="hljs-function">AliAnalysisTaskMyTask* <span class="hljs-title">AddMyTask</span><span class="hljs-params">(TString name = <span class="hljs-string">&quot;name&quot;</span>)</span> </span>{
  AliAnalysisManager *mgr = AliAnalysisManager::GetAnalysisManager();

  <span class="hljs-comment">// resolve the name of the output file</span>
  TString fileName = AliAnalysisManager::GetCommonFileName();
  fileName += <span class="hljs-string">&quot;:MyTask&quot;</span>;      <span class="hljs-comment">// create a subfolder in the file</span>

  <span class="hljs-comment">// now we create an instance of your task</span>
  AliAnalysisTaskMyTask* task = <span class="hljs-keyword">new</span> AliAnalysisTaskMyTask(name.Data());   

  <span class="hljs-comment">// add your task to the manager</span>
  mgr-&gt;AddTask(task);

  <span class="hljs-comment">// connect the manager to your task</span>
  mgr-&gt;ConnectInput(task,<span class="hljs-number">0</span>,mgr-&gt;GetCommonInputContainer());
  <span class="hljs-comment">// same for the output</span>
  mgr-&gt;ConnectOutput(task,<span class="hljs-number">1</span>,mgr-&gt;CreateContainer(<span class="hljs-string">&quot;MyOutputContainer&quot;</span>, TList::Class(), AliAnalysisManager::kOutputContainer, fileName.Data()));

  <span class="hljs-comment">// important: return a pointer to your task</span>
  <span class="hljs-keyword">return</span> task;
}
</code></pre>
<p>And that&apos;s it - we now have our three files that contain a minimal analysis!</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="classes.html" class="navigation navigation-prev " aria-label="Previous page: AliAnalysisTaskSE">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="local.html" class="navigation navigation-next " aria-label="Next page: Running locally">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Your analysis task","level":"1.4.2","depth":2,"next":{"title":"Running locally","level":"1.4.3","depth":2,"path":"analysis/local.md","ref":"analysis/local.md","articles":[]},"previous":{"title":"AliAnalysisTaskSE","level":"1.4.1","depth":2,"path":"analysis/classes.md","ref":"analysis/classes.md","articles":[]},"dir":"ltr"},"config":{"plugins":["katex","panels@git+https://github.com/lhcb/gitbook-plugin-panels.git#117012fdc18c96831cb88196980c0ea73b0c87b8","collapsible-menu","block-align","page-toc"],"styles":{"website":"css/website.css"},"pluginsConfig":{"collapsible-menu":{},"block-align":{},"search":{},"page-toc":{"position":"before-first","selector":".markdown-section h1, .markdown-section h2, .markdown-section h3, .markdown-section h4","showByDefault":true},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"panels":{},"katex":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"ALICE Analysis Tutorial","gitbook":"*","description":"Introduction to the common analysis techniques and tools of ALICE"},"file":{"path":"analysis/alianalysistaskmytask.md","mtime":"2021-05-25T13:42:30.030Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-05-25T13:43:24.041Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-panels/panels.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-page-toc/anchor-3.1.1.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-page-toc/page-toc.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

